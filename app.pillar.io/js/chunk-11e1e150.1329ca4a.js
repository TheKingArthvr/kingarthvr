(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-11e1e150"],{"1f81":function(t,e,n){"use strict";var r,i,o,a,s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("LinkPopup",{attrs:{type:"product",organization:t.organization,loadingLink:t.loadingLink,shopUrl:t.shopUrl,linkKey:t.linkKey,link:t.link,copyLink:t.copyLink,errorGenerating:t.errorGenerating},on:{closed:function(e){return t.$emit("closed")},addToShop:t.addToShop}})},c=[],u=n("c964"),l=n("e5e9"),d=(n("96cf"),n("99af"),n("9911"),n("ac1f"),n("5319"),n("b0c0"),n("d28b"),n("d3b7"),n("3ca3"),n("ddb0"),n("a4d3"),n("e01a"),n("5184")),p=n("2b0e"),m=n("e1bd"),f=n("cacd"),h=Object(d["a"])(r||(r=Object(l["a"])(["\n\tquery GetShopUrlKey($influencer_id: uuid!) {\n\t\turl_key: shop_banner_by_pk(influencer_id: $influencer_id) {\n\t\t\turl_key\n\t\t}\n\t}\n"]))),k=Object(d["a"])(i||(i=Object(l["a"])(["\n\tquery GetProductLink($influencerId: uuid!, $networkProductId: String!) {\n\t\tproductLinks: attribution_product_link(\n\t\t\twhere: {\n\t\t\t\tlink: { influencer_id: { _eq: $influencerId } }\n\t\t\t\tproduct: {\n\t\t\t\t\tnetwork_products: { network_product_id: { _eq: $networkProductId } }\n\t\t\t\t}\n\t\t\t}\n\t\t) {\n\t\t\tlink {\n\t\t\t\tid\n\t\t\t\tkey\n\t\t\t\tstatus\n\t\t\t}\n\t\t}\n\t}\n"]))),v=Object(d["a"])(o||(o=Object(l["a"])(["\n\tmutation InsertProductLink(\n\t\t$productLink: attribution_product_link_insert_input!\n\t) {\n\t\tinsert_attribution_product_link(objects: [$productLink]) {\n\t\t\taffected_rows\n\t\t}\n\t}\n"]))),g=Object(d["a"])(a||(a=Object(l["a"])(['\n\tmutation ActivateLinkById($linkId: uuid!) {\n\t\tupdate_attribution_link_by_pk(\n\t\t\tpk_columns: { id: $linkId }\n\t\t\t_set: { status: "ACTIVE" }\n\t\t) {\n\t\t\tid\n\t\t}\n\t}\n']))),_=p["default"].extend({props:{product:Object,organization:Object,addToShop:Function},components:{LinkPopup:f["a"]},data:function(){return{loadingLink:!0,shopUrl:"",linkKey:"",errorGenerating:!1}},computed:{link:function(){return"".concat(this.$data.$shopDomain,"/").concat(this.shopUrl,"/").concat(this.linkKey)}},mounted:function(){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function e(){var n,r,i,o,a,s,c,u,l,d,p,f;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log(t.product.network_product_id),!t.product.network_product_id){e.next=15;break}return e.next=4,t.$apollo.query({fetchPolicy:"no-cache",query:k,variables:{influencerId:t.$user.influencer.id,networkProductId:t.product.network_product_id}});case 4:if(o=e.sent,console.log(o),o.error&&console.error(o.error),a=null===(n=o.data)||void 0===n||null===(r=n.productLinks)||void 0===r||null===(i=r[0])||void 0===i?void 0:i.link,null===a||void 0===a||!a.key){e.next=15;break}if("INACTIVE"!==(null===a||void 0===a?void 0:a.status)){e.next=12;break}return e.next=12,t.$apollo.query({fetchPolicy:"no-cache",query:g,variables:{linkId:a.id}});case 12:return t.linkKey=null===a||void 0===a?void 0:a.key,t.loadingLink=!1,e.abrupt("return");case 15:if(s=t.product.name.normalize("NFD").replace(/[^a-zA-Z0-9]/g,"").substring(0,8).toLowerCase()||Object(m["a"])(6),c=t.organization.name.normalize("NFD").replace(/[^a-zA-Z0-9]/g,"").substring(0,8).toLowerCase()||Object(m["a"])(6),t.linkKey="".concat(c,"/").concat(s),e.prev=18,t.product.network_product_id){e.next=21;break}throw new Error("product must have network_product_id to generate affiliateLink");case 21:return e.next=23,t.$axios.get("affiliates/links",{params:{network_product_id:t.product.network_product_id,influencer_id:t.$user.influencer.id}});case 23:return d=e.sent,p=null===d||void 0===d||null===(u=d.data)||void 0===u?void 0:u.link,f=null===d||void 0===d||null===(l=d.data)||void 0===l?void 0:l.product,t.product.id=f.product.id,e.next=29,t.createLink(p,t.linkKey,f.product.id,0);case 29:e.next=36;break;case 31:e.prev=31,e.t0=e["catch"](18),console.error(e.t0),t.$notify({type:"error",title:"Error",text:"An error occurred while generating your affiliate link."}),t.errorGenerating=!0;case 36:t.loadingLink=!1;case 37:case"end":return e.stop()}}),e,null,[[18,31]])})))()},methods:{copyLink:function(){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.loadingLink){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,navigator.clipboard.writeText("https://".concat(t.link));case 4:t.$notify({type:"success",title:"Success",text:"Link copied to clipboard!"});case 5:case"end":return e.stop()}}),e)})))()},createLink:function(t,e,n,r){var i=this;return Object(u["a"])(regeneratorRuntime.mark((function o(){var a;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return a=e+(r>0?"-"+r:""),i.linkKey=a,o.next=4,i.$apollo.mutate({mutation:v,variables:{productLink:{product_id:n,link:{data:{influencer_id:i.$user.influencer.id,url:t,key:a}}}}}).catch(function(){var o=Object(u["a"])(regeneratorRuntime.mark((function o(a){var s,c,u,l,d,p,m,f;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:for(s=!1,c=a["graphQLErrors"],u=!0,l=!1,d=void 0,o.prev=5,p=c[Symbol.iterator]();!(u=(m=p.next()).done);u=!0)f=m.value,"constraint-violation"===f.extensions.code&&(s=!0),console.log(f);o.next=13;break;case 9:o.prev=9,o.t0=o["catch"](5),l=!0,d=o.t0;case 13:o.prev=13,o.prev=14,u||null==p.return||p.return();case 16:if(o.prev=16,!l){o.next=19;break}throw d;case 19:return o.finish(16);case 20:return o.finish(13);case 21:if(!s){o.next=26;break}return o.next=24,i.createLink(t,e,n,r+1);case 24:o.next=27;break;case 26:console.error(a);case 27:case"end":return o.stop()}}),o,null,[[5,9,13,21],[14,,16,20]])})));return function(t){return o.apply(this,arguments)}}());case 4:case"end":return o.stop()}}),o)})))()}},apollo:{shopUrl:{query:h,variables:function(){return{influencer_id:this.$user.influencer.id}},update:function(t){return t.url_key.url_key}}}}),b=_,x=n("2877"),y=Object(x["a"])(b,s,c,!1,null,null,null);e["a"]=y.exports},"30b6":function(t,e,n){},"3f67":function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"popup-background"},[n("div",{ref:"slot"},[t._t("default")],2)])},i=[],o=n("2b0e"),a=o["default"].extend({methods:{clickAwayHandler:function(t){var e=this.$refs.slot;e.contains(t.target)||this.$emit("clicked-away")}},mounted:function(){window.addEventListener("click",this.clickAwayHandler)},destroyed:function(){window.removeEventListener("click",this.clickAwayHandler)}}),s=a,c=(n("48e6"),n("2877")),u=Object(c["a"])(s,r,i,!1,null,"ec08ad04",null);e["a"]=u.exports},"475e":function(t,e,n){"use strict";n("af30")},"48e6":function(t,e,n){"use strict";n("b022")},5536:function(t,e,n){"use strict";n("9b0b")},"69b7":function(t,e,n){"use strict";n.r(e);var r,i,o,a,s,c,u,l,d,p,m,f,h=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"page-container"},[t.showCommissionModal&&t.organization.commission_description?n("Modal",{attrs:{open:t.showCommissionModal},on:{close:function(e){t.showCommissionModal=!1}}},[n("div",{staticClass:"container relative overflow-scroll"},[n("h2",{staticClass:"text-2xl font-extrabold sm:text-2xl"},[t._v("Commission Details")]),n("ul",{staticClass:"divide-y divide-gray-200"},t._l(t.organization.commission_description,(function(e){return n("li",{key:e.id},[t._v(" "+t._s(e.name)+" : "+t._s(e.commission.description["#text"]?e.commission.description["#text"]:e.commission.description)+" "),e.commission.items.length>0?n("ul",{style:{padding:"20px"}},t._l(e.commission.items,(function(e){return n("li",{key:e.id},[t._v(" "+t._s(e.name)+" : "+t._s(e.description["#text"]?e.description["#text"]:e.description)+" ")])})),0):t._e()])})),0)])]):t._e(),n("section",[n("h3",{staticClass:"font-semibold text-xl mb-4"},[t._v("Brand Deal")]),n("div",{staticClass:"deals-container rounded-lg bg-white p-4 mb-4 flex"},[t.organization?n("div",{staticClass:"deal-row w-full flex-wrap flex flex-row justify-between"},[n("div",{staticClass:"flex items-center"},[t.organization.image_logo?n("img",{staticClass:"h-10 mr-4",attrs:{src:t.organization.image_logo,alt:"Logo"}}):n("div",{staticClass:"h-10 mr-4 flex items-center"},[t._v(" "+t._s(t.organization.name)+" ")]),n("a",{staticClass:"text-gray-400 hover:text-gray-600 transition-colors duration-200 cursor-pointer",attrs:{target:"_blank"},on:{click:function(e){return e.stopPropagation(),t.$open(t.organization.website_url)}}},[n("i",{staticClass:"fas fa-external-link-alt"})])]),n("div",{staticClass:"flex",on:{click:function(e){e.stopPropagation(),t.showCommissionModal=!t.showCommissionModal}}},[t.organization.commission_estimate>0||null!=t.organization.commission_summary?n("div",{staticClass:"mr-4"},[n("div",{staticClass:"text-xl text-indigo-600 font-medium"},[t._v(" "+t._s(t.organization.commission_estimate>0?t.organization.commission_estimate+"%":t.organization.commission_summary)+" ")]),n("div",{staticClass:"text-sm text-gray-400"},[t._v("Commission")])]):t._e(),t.organization.flat_commission>0?n("div",{staticClass:"mr-4"},[n("div",{staticClass:"text-xl text-indigo-600 font-medium"},[t._v(" "+t._s(t.$numeralFormat(t.organization.flat_commission,"$0.00"))+" ")]),n("div",{staticClass:"text-sm text-gray-400"},[t._v("Commission")])]):t._e(),t.organization.epc_90>0?n("div",{staticClass:"ml-2"},[n("div",{staticClass:"text-xl text-indigo-600 font-medium"},[t._v(" "+t._s(t.$numeralFormat(t.organization.epc_90,"$0.00"))+" ")]),n("div",{staticClass:"text-sm text-gray-400"},[t._v("EPC")])]):t._e()]),n("div",{staticClass:"flex items-center w-full justify-between mt-4 sm:w-auto sm:justify-end sm:mt-0"},[t.organizationLinkKey?t._e():n("span",{staticClass:"desktop call-to-action text-base mr-4"},[t._v(" Ready to promote "+t._s(t.organization.name)+"? ")]),t.organizationLinkKey?t._e():n("span",{staticClass:"mobile call-to-action text-xs mr-4"},[t._v(" Promote "+t._s(t.organization.name)+"? ")]),t.organizationLinkKey?n("div",{staticClass:"buttons flex flex-col md:flex-row w-full"},[n("button",{staticClass:"rounded copy-button mr-1",on:{click:function(e){return t.copyLink()}}},[n("i",{staticClass:"fas fa-link"}),t._v("Copy Link ")]),n("button",{staticClass:"rounded primary mr-1",on:{click:t.toggleLinkInShop}},[t._v(" "+t._s(t.existingShopCustomLinkIds.length?"Remove from My Pillar":"Add to My Pillar")+" ")]),n("button",{staticClass:"rounded secondary cancel-deal-button",on:{click:function(e){t.showConfirm=!0}}},[t._v(" End Promotion "),n("i",{staticClass:"fal fa-times"})])]):n("div",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.promotionLimitReached&&t.isProUser?`<div style='width: 225px; text-align: center;'>You've generated all ${t.maxProLinks} of your<br/>links â€” awesome job! ðŸš€</div>`:null,html:!0},expression:"{\n\t\t\t\t\t\t\tcontent:\n\t\t\t\t\t\t\t\tpromotionLimitReached && isProUser\n\t\t\t\t\t\t\t\t\t? `<div style='width: 225px; text-align: center;'>You've generated all ${maxProLinks} of your<br/>links â€” awesome job! ðŸš€</div>`\n\t\t\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\t\thtml: true\n\t\t\t\t\t\t}"}],staticClass:"tooltip-wrapper"},[n("button",{staticClass:"button primary rounded",attrs:{disabled:t.promotionLimitReached&&t.isProUser},on:{click:function(e){return e.stopPropagation(),t.handleGenerateClick.apply(null,arguments)}}},[t._v(" Generate Brand Link ")])])])]):t._e(),t.showConfirm?n("ConfirmationModal",{attrs:{title:"End Promotion",text:"Are you sure you want to end this promotion? Your promotion link may change should you decide to promote this product again. This action\n\t            cannot be undone."},on:{cancel:function(e){t.showConfirm=!1},confirm:t.removeDeal}}):t._e(),t.displayPopup?n("PopupContainer",{staticClass:"popup-container",on:{"clicked-away":t.handlePopupClosed}},[n("BrandPromotionPopup",{staticClass:"popup",attrs:{addToShop:t.addToShop,organization:t.organization},on:{closed:t.handlePopupClosed}})],1):t._e()],1)]),t.organization?n("section",{staticClass:"mb-4"},[n("p",{staticClass:"text-gray-500"},[t._v(" "+t._s(t.organization.description)+" ")])]):t._e(),n("section",[n("div",{staticClass:"search bg-white"},[n("i",{staticClass:"search-icon far fa-search"}),n("input",{directives:[{name:"model",rawName:"v-model",value:t.searchCriteria,expression:"searchCriteria"}],attrs:{type:"text",placeholder:"Search for product deals"},domProps:{value:t.searchCriteria},on:{input:[function(e){e.target.composing||(t.searchCriteria=e.target.value)},t.handleSearch]}})])]),n("section",[n("h3",{staticClass:"font-semibold text-xl mb-4 mt-2"},[t._v("Product Deals")]),n("div",{staticClass:"module-section-links mb-4"},[n("div",[n("div",{staticClass:"module-section-link font-medium text-sm",class:{selected:"all"==t.searchOption},on:{click:function(e){return t.$router.replace({query:{search:"all"}})}}},[t._v(" All ")])]),n("div",[n("div",{staticClass:"module-section-link font-medium text-sm",class:{selected:"live"==t.searchOption},on:{click:function(e){t.$router.replace({query:{search:"live"}}),t.loadPromotedProducts()}}},[t._v(" Live ")])])]),t.filteredProducts.length>0?n("div",{staticClass:"deals-container rounded-lg bg-white p-4 flex flex-col products"},[t._l(t.filteredProducts,(function(e){return n("ProductRow",{key:"desktop"+e.network_product_id,staticClass:"desktop product-row border-b border-solid border-indigo-100",attrs:{id:e.network_product_id,product:e,organization:t.organization},on:{onEndPromotion:function(n){return t.endProductPromotion(e.network_product_id)}}})})),t._l(t.filteredProducts,(function(e){return n("MobileProductRow",{key:"mobile"+e.network_product_id,staticClass:"mobile product-row",attrs:{id:e.network_product_id,product:e,organization:t.organization},on:{onEndPromotion:function(n){return t.endProductPromotion(e.network_product_id)}}})}))],2):t._e(),t.nextPageLoading?n("div",{staticClass:"flex h-8 justify-center items-center mt-4"},[n("i",{staticClass:"fas fa-spinner fa-spin text-gray-400"})]):t._e(),t.organization&&!t.nextPageLoading&&0==t.filteredProducts.length?n("div",{staticClass:"empty-products text-gray-600 flex flex-col items-center"},[n("div",[t._v(" "+t._s(t.organization.name)+" doesn't seem to have any products "+t._s("live"==t.searchOption?"you're promoting right now.":"to promote right now.")+" ")]),n("div",[t._v(" Consider "),n("a",{staticClass:"text-indigo-600 hover:text-indigo-800 cursor-pointer",on:{click:function(e){return e.stopPropagation(),t.handleGenerateClick.apply(null,arguments)}}},[t._v("promoting "+t._s(t.organization.name)+" itself")]),t._v(", or check back later. ")])]):t._e()])],1)},k=[],v=n("d0ff"),g=n("c964"),_=n("f3f3"),b=n("e5e9"),x=(n("96cf"),n("ac1f"),n("841c"),n("99af"),n("d81d"),n("4de4"),n("9911"),n("b0c0"),n("5319"),n("3f67")),y=n("5184"),w=n("2f62"),P=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"product-row flex justify-between"},[n("a",{staticClass:"product-image rounded-lg",style:`--image: url('${t.product.image_url}')`,attrs:{href:t.product.product_url,target:"_blank",rel:"noopener noreferrer"}}),n("div",{staticClass:"details flex flex-col ml-4"},[n("span",{staticClass:"pill-label"},[t._v("Product Promotion")]),n("a",{staticClass:"font-medium text-base my-2 pr-4 hover:underline",attrs:{href:t.product.product_url,target:"_blank"}},[t._v(t._s(t.product.name))]),n("div",{staticClass:"commissions"},[t.earningAmount?n("div",{staticClass:"commission text-sm font-medium"},[n("span",{staticClass:"text-black"},[t._v("You will earn")]),n("span",{staticClass:"text-indigo-600"},[t._v(" "+t._s(t.earningAmount)+" ")]),n("span",{staticClass:"text-black"},[t._v("per sale")])]):t._e()])]),n("div",{staticClass:"buttons flex items-center"},[t.linkKey?n("div",[n("button",{staticClass:"rounded copy-button mr-1",on:{click:function(e){return t.copyLink()}}},[n("i",{staticClass:"fas fa-link"}),t._v("Copy Link ")]),n("button",{staticClass:"rounded primary mr-1",on:{click:t.toggleProductInShop}},[t._v(" "+t._s(t.existingShopProductIds.length?"Remove from My Pillar":"Add to My Pillar")+" ")]),n("button",{staticClass:"rounded secondary cancel-deal-button",on:{click:function(e){t.showConfirm=!0}}},[t._v(" End Promotion "),n("i",{staticClass:"fal fa-times"})])]):n("div",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.promotionLimitReached&&t.isProUser?`<div style='width: 225px; text-align: center;'>You've generated all ${t.maxProLinks} of your<br/>links â€” awesome job! ðŸš€</div>`:null,html:!0},expression:"{\n\t\t\t\t\tcontent:\n\t\t\t\t\t\tpromotionLimitReached && isProUser\n\t\t\t\t\t\t\t? `<div style='width: 225px; text-align: center;'>You've generated all ${maxProLinks} of your<br/>links â€” awesome job! ðŸš€</div>`\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\thtml: true\n\t\t\t\t}"}],staticClass:"tooltip-wrapper"},[t.deal?n("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:"\n\t\t\t\t\t\t\t<div style='width: 230px; text-align: center;'>\n\t\t\t\t\t\t\t\tThis product has a coupon. Generate a link and add it to your Pillar page to show the code.\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t",html:!0},expression:"{\n\t\t\t\t\t\tcontent: `\n\t\t\t\t\t\t\t<div style='width: 230px; text-align: center;'>\n\t\t\t\t\t\t\t\tThis product has a coupon. Generate a link and add it to your Pillar page to show the code.\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`,\n\t\t\t\t\t\thtml: true\n\t\t\t\t\t}"}],staticClass:"mr-4 cursor-default"},[t._v(" ðŸŽŸï¸ ")]):t._e(),n("button",{staticClass:"rounded primary",attrs:{disabled:t.promotionLimitReached&&t.isProUser},on:{click:function(e){return e.stopPropagation(),t.handleGenerateClick.apply(null,arguments)}}},[t._v(" Generate Product Link ")])])]),t.showConfirm?n("ConfirmationModal",{attrs:{title:"End Promotion",text:"Are you sure you want to end this promotion? Your promotion link may change should you decide to promote this product again. This action\n            cannot be undone."},on:{cancel:function(e){t.showConfirm=!1},confirm:t.removeDeal}}):t._e(),t.displayProductPopup?n("PopupContainer",{staticClass:"popup-container",on:{"clicked-away":function(e){return t.handlePopupClosed("product")}}},[n("ProductPromotionPopup",{staticClass:"popup",attrs:{addToShop:t.addProductToShop,product:t.product,organization:t.organization},on:{closed:function(e){return t.handlePopupClosed("product")}}})],1):t._e(),t.displayDealPopup?n("PopupContainer",{staticClass:"popup-container",on:{"clicked-away":function(e){return t.handlePopupClosed("deal")}}},[n("DealPromotionPopup",{staticClass:"popup",attrs:{addToShop:t.addDealToShop,deal:t.deal,organization:t.organization},on:{closed:function(e){return t.handlePopupClosed("deal")}}})],1):t._e()],1)},L=[],C=(n("a4d3"),n("e01a"),n("7db0"),n("2b0e")),$=n("a29c"),O=n("1f81"),j=n("92c1"),z=n("9613"),R=n("2bd0"),I=Object(y["a"])(r||(r=Object(b["a"])(['\n\tquery GetProductLink($influencerId: uuid!, $networkProductId: String!) {\n\t\tproductLinks: attribution_product_link(\n\t\t\twhere: {\n\t\t\t\tlink: {\n\t\t\t\t\tinfluencer_id: { _eq: $influencerId }\n\t\t\t\t\tstatus: { _eq: "ACTIVE" }\n\t\t\t\t}\n\t\t\t\tproduct: {\n\t\t\t\t\tnetwork_products: { network_product_id: { _eq: $networkProductId } }\n\t\t\t\t}\n\t\t\t}\n\t\t) {\n\t\t\tlink {\n\t\t\t\tkey\n\t\t\t}\n\t\t}\n\t}\n']))),S=Object(y["a"])(i||(i=Object(b["a"])(["\n\tquery GetShopUrlKey($influencer_id: uuid!) {\n\t\turl_key: shop_banner_by_pk(influencer_id: $influencer_id) {\n\t\t\turl_key\n\t\t}\n\t}\n"]))),q=Object(y["a"])(o||(o=Object(b["a"])(["\n\tquery GetDeals {\n\t\tdeals: campaigns_deal {\n\t\t\tid\n\t\t\tname\n\t\t\tdescription\n\t\t\tnetwork_product_id\n\t\t\tnetwork_advertiser_id\n\t\t\timage_url\n\t\t\ttracking_link\n\t\t\tend_date\n\t\t}\n\t}\n"]))),A=C["default"].extend({components:{PopupContainer:x["a"],ProductPromotionPopup:O["a"],DealPromotionPopup:$["a"],ConfirmationModal:j["a"]},props:{product:Object,organization:Object},data:function(){return{displayProductPopup:!1,displayDealPopup:!1,linkKey:"",shopUrl:"",showConfirm:!1,deal:null}},computed:Object(_["a"])(Object(_["a"])({},Object(w["c"])({products:"products",activePromotedLinks:"activePromotedLinks",promotionLinkLimit:"promotionLinkLimit"})),{},{link:function(){return"https://".concat(this.$data.$shopDomain,"/").concat(this.shopUrl,"/").concat(this.linkKey)},existingShopProductIds:function(){var t=this;return this.products.filter((function(e){return e.url===t.link})).map((function(t){return t.product_id}))},promotionLimitReached:function(){return this.activePromotedLinks.length>=this.promotionLinkLimit},maxProLinks:function(){return R["a"].PROMOTED_LINKS.MAX_PRO},isProUser:function(){var t,e;return null!==(t=null===(e=this.$user)||void 0===e?void 0:e.athlane_pro)&&void 0!==t&&t},earningAmount:function(){var t,e,n,r=null!==(t=null===(e=this.product)||void 0===e||null===(n=e.price)||void 0===n?void 0:n[0])&&void 0!==t?t:null;if(!r)return null;var i=z["e"][r.currency],o=r.amount,a=this.organization.commission_estimate;return parseFloat(o)>0&&parseFloat(a)>0?"".concat(i).concat(this.$numeralFormat(o*a/100,"0.00")):null}}),mounted:function(){this.fetchOrUpdateLink()},methods:{removeDeal:function(){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.existingShopProductIds.length){e.next=3;break}return e.next=3,t.toggleProductInShop();case 3:t.linkKey="",t.showConfirm=!1,t.$store.dispatch("fetchShopData",t.$user.influencer.id),t.$emit("onEndPromotion");case 7:case"end":return e.stop()}}),e)})))()},fetchOrUpdateLink:function(t){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var n,r,i,o,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$apollo.query({query:I,variables:{influencerId:e.$user.influencer.id,networkProductId:e.product.network_product_id},fetchPolicy:"no-cache"});case 2:s=t.sent,e.linkKey=null!==(n=null===s||void 0===s||null===(r=s.data)||void 0===r||null===(i=r.productLinks)||void 0===i||null===(o=i[0])||void 0===o||null===(a=o.link)||void 0===a?void 0:a.key)&&void 0!==n?n:"";case 4:case"end":return t.stop()}}),t)})))()},copyLink:function(){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$copyText(t.link);case 2:t.$notify({type:"success",title:"Success",text:"Link copied to clipboard!"});case 3:case"end":return e.stop()}}),e)})))()},toggleProductInShop:function(){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=Object(v["a"])(t.existingShopProductIds),n.length){e.next=5;break}t.addProductToShop(t.link),e.next=12;break;case 5:r=0;case 6:if(!(r<n.length)){e.next=12;break}return e.next=9,t.removeFromShop(n[r]);case 9:r++,e.next=6;break;case 12:case"end":return e.stop()}}),e)})))()},addProductToShop:function(t){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$store.dispatch("addProduct",{image:e.product.image_url,name:e.product.name,description:"",url:t,price:null!==(r=e.product.price.amount)&&void 0!==r?r:0});case 2:return e.$dropConfetti(),n.next=5,e.fetchOrUpdateLink(!0);case 5:return n.next=7,e.$store.dispatch("fetchActivePromotedLinks");case 7:e.displayProductPopup=!1;case 8:case"end":return n.stop()}}),n)})))()},addDealToShop:function(t){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$store.dispatch("addProduct",{image:e.deal.image_url,name:e.deal.name,description:e.deal.description,url:t,price:0,deal_id:e.deal.id});case 2:return e.$dropConfetti(),n.next=5,e.fetchOrUpdateLink(!0);case 5:return n.next=7,e.$store.dispatch("fetchActivePromotedLinks");case 7:e.displayDealPopup=!1;case 8:case"end":return n.stop()}}),n)})))()},removeFromShop:function(t){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.$store.dispatch("deleteProduct",t);case 1:case"end":return n.stop()}}),n)})))()},handleGenerateClick:function(){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("fetchActivePromotedLinks");case 2:if(!(t.$store.getters.activePromotedLinks.length>=t.$store.getters.promotionLinkLimit)){e.next=6;break}return t.$router.replace({hash:"#show-upgrade",query:{p_limit:!0}}),t.$amp.logEvent("SHOWN_PAYWALL",{reason:"link-limit-reached",origin:"generate-product-link"}),e.abrupt("return");case 6:t.$amp.logEvent("GENERATED_LINK_FROM_ORG",{type:t.deal?"deal":"product",item:null!==(n=t.deal)&&void 0!==n?n:t.product}),t.deal?t.displayDealPopup=!0:t.displayProductPopup=!0;case 8:case"end":return e.stop()}}),e)})))()},handlePopupClosed:function(t){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.fetchOrUpdateLink(!0),n.next=3,e.$store.dispatch("fetchActivePromotedLinks");case 3:n.t0=t,n.next="product"===n.t0?6:"deal"===n.t0?8:10;break;case 6:return e.displayProductPopup=!1,n.abrupt("break",10);case 8:return e.displayDealPopup=!1,n.abrupt("break",10);case 10:case"end":return n.stop()}}),n)})))()}},apollo:{shopUrl:{query:S,variables:function(){var t;return{influencer_id:null===(t=this.$user)||void 0===t?void 0:t.influencer.id}},update:function(t){var e,n;return null!==(e=null===t||void 0===t||null===(n=t.url_key)||void 0===n?void 0:n.url_key)&&void 0!==e?e:""}},deals:{query:q,result:function(t){var e,n=this;this.deal=null!==(e=t.data.deals.find((function(t){return t.network_product_id===n.product.network_product_id})))&&void 0!==e?e:null}}}}),E=A,T=(n("5536"),n("2877")),U=Object(T["a"])(E,P,L,!1,null,"28f29f12",null),G=U.exports,K=n("6ed5"),D=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"product-row"},[n("a",{staticClass:"product-image",style:`--image: url('${t.product.image_url}')`,attrs:{href:t.product.product_url,target:"_blank"}}),n("div",{staticClass:"details"},[n("a",{attrs:{href:t.product.product_url,target:"_blank"}},[t._v(t._s(t.product.name))]),n("div",{staticClass:"commissions"},[t.earningAmount?n("div",{staticClass:"commission text-small"},[n("span",{staticClass:"text-black"},[t._v("You will earn")]),n("span",{staticClass:"text-indigo-600"},[t._v(" "+t._s(t.earningAmount)+" ")]),n("span",{staticClass:"text-black"},[t._v("per sale")])]):t._e(),t.deal?n("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:"\n\t\t\t\t\t\t\t<div style='width: 230px; text-align: center;'>\n\t\t\t\t\t\t\t\tThis product has a coupon. Generate a link and add it to your Pillar page to show the code.\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t",html:!0},expression:"{\n\t\t\t\t\t\tcontent: `\n\t\t\t\t\t\t\t<div style='width: 230px; text-align: center;'>\n\t\t\t\t\t\t\t\tThis product has a coupon. Generate a link and add it to your Pillar page to show the code.\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`,\n\t\t\t\t\t\thtml: true\n\t\t\t\t\t}"}],staticClass:"mt-1 ml-auto"},[t._v(" ðŸŽŸï¸ ")]):t._e()]),t.linkKey?n("div",{staticClass:"buttons flex flex-col"},[n("button",{staticClass:"rounded copy-button mb-2",on:{click:function(e){return t.copyLink()}}},[n("i",{staticClass:"fas fa-link"}),t._v("Copy Link ")]),n("button",{staticClass:"rounded primary mb-2",on:{click:t.toggleProductInShop}},[t._v(" "+t._s(t.existingShopProductIds.length?"Remove from My Pillar":"Add to My Pillar")+" ")]),n("button",{staticClass:"rounded secondary cancel-deal-button mb-2",on:{click:function(e){t.showConfirm=!0}}},[t._v(" End Promotion ")])]):n("div",{staticClass:"buttons flex flex-col"},[t.linkKey?t._e():n("button",{staticClass:"rounded primary mb-2",attrs:{disabled:t.promotionLimitReached&&t.isProUser},on:{click:function(e){return e.stopPropagation(),t.handleGenerateClick.apply(null,arguments)}}},[t._v(" Generate Product Link ")]),t.promotionLimitReached&&t.isProUser?n("span",{staticClass:"text-gray-700 text-small text-center"},[t._v(" You've generated all "+t._s(t.maxProLinks)+" of your links â€” awesome job! ðŸš€ ")]):t._e()])]),t.showConfirm?n("ConfirmationModal",{attrs:{title:"End Promotion",text:"Are you sure you want to end this promotion? Your promotion link may change should you decide to promote this product again. This action\n            cannot be undone."},on:{cancel:function(e){t.showConfirm=!1},confirm:t.removeDeal}}):t._e(),t.displayPopup?n("PopupContainer",{staticClass:"popup-container",on:{"clicked-away":function(e){return t.handlePopupClosed("product")}}},[n("ProductPromotionPopup",{staticClass:"popup",attrs:{addToShop:t.addToShop,product:t.product,organization:t.organization},on:{closed:function(e){return t.handlePopupClosed("product")}}})],1):t._e(),t.displayDealPopup?n("PopupContainer",{staticClass:"popup-container",on:{"clicked-away":function(e){return t.handlePopupClosed("deal")}}},[n("DealPromotionPopup",{staticClass:"popup",attrs:{addToShop:t.addDealToShop,deal:t.deal,organization:t.organization},on:{closed:function(e){return t.handlePopupClosed("deal")}}})],1):t._e()],1)},M=[],F=n("0f43"),N=Object(y["a"])(a||(a=Object(b["a"])(['\n\tquery GetProductLink($influencerId: uuid!, $networkProductId: String!) {\n\t\tproductLinks: attribution_product_link(\n\t\t\twhere: {\n\t\t\t\tlink: {\n\t\t\t\t\tinfluencer_id: { _eq: $influencerId }\n\t\t\t\t\tstatus: { _eq: "ACTIVE" }\n\t\t\t\t}\n\t\t\t\tproduct: {\n\t\t\t\t\tnetwork_products: { network_product_id: { _eq: $networkProductId } }\n\t\t\t\t}\n\t\t\t}\n\t\t) {\n\t\t\tlink {\n\t\t\t\tkey\n\t\t\t}\n\t\t}\n\t}\n']))),Y=Object(y["a"])(s||(s=Object(b["a"])(["\n\tquery GetShopUrlKey($influencer_id: uuid!) {\n\t\turl_key: shop_banner_by_pk(influencer_id: $influencer_id) {\n\t\t\turl_key\n\t\t}\n\t}\n"]))),B=Object(y["a"])(c||(c=Object(b["a"])(["\n\tquery GetDeals {\n\t\tdeals: campaigns_deal {\n\t\t\tid\n\t\t\tname\n\t\t\tdescription\n\t\t\tnetwork_product_id\n\t\t\tnetwork_advertiser_id\n\t\t\timage_url\n\t\t\ttracking_link\n\t\t\tend_date\n\t\t}\n\t}\n"]))),V=C["default"].extend({components:{PopupContainer:x["a"],ProductPromotionPopup:O["a"],DealPromotionPopup:$["a"],ConfirmationModal:j["a"]},props:{product:Object,organization:Object},data:function(){return{displayPopup:!1,displayDealPopup:!1,linkKey:"",shopUrl:"",showConfirm:!1,deal:null}},computed:Object(_["a"])(Object(_["a"])({},Object(w["c"])({products:"products",activePromotedLinks:"activePromotedLinks",promotionLinkLimit:"promotionLinkLimit"})),{},{link:function(){return"https://".concat(this.$data.$shopDomain,"/").concat(this.shopUrl,"/").concat(this.linkKey)},existingShopProductIds:function(){var t=this;return this.products.filter((function(e){return e.url===t.link})).map((function(t){return t.product_id}))},promotionLimitReached:function(){return this.activePromotedLinks.length>=this.promotionLinkLimit},maxProLinks:function(){return R["a"].PROMOTED_LINKS.MAX_PRO},isProUser:function(){var t,e;return null!==(t=null===(e=this.$user)||void 0===e?void 0:e.athlane_pro)&&void 0!==t&&t},earningAmount:function(){var t,e,n,r=null!==(t=null===(e=this.product)||void 0===e||null===(n=e.price)||void 0===n?void 0:n[0])&&void 0!==t?t:null;if(!r)return null;var i=z["e"][r.currency],o=r.amount,a=this.organization.commission_estimate;return parseFloat(o)>0&&parseFloat(a)>0?"".concat(i).concat(this.$numeralFormat(o*a/100,"0.00")):null}}),mounted:function(){this.fetchOrUpdateLink()},methods:{removeDeal:function(){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.existingShopProductIds.length){e.next=3;break}return e.next=3,t.toggleProductInShop();case 3:return t.linkKey="",t.showConfirm=!1,t.$store.dispatch("fetchShopData",t.$user.influencer.id),e.next=8,t.$emit("onEndPromotion");case 8:case"end":return e.stop()}}),e)})))()},fetchOrUpdateLink:function(t){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var n,r,i,o,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$apollo.query({query:N,variables:{influencerId:e.$user.influencer.id,networkProductId:e.product.network_product_id},fetchPolicy:"no-cache"});case 2:if(t.t1=n=t.sent,t.t0=null===t.t1,t.t0){t.next=6;break}t.t0=void 0===n;case 6:if(!t.t0){t.next=10;break}t.t2=void 0,t.next=11;break;case 10:t.t2=null===(r=n.data)||void 0===r||null===(i=r.productLinks)||void 0===i||null===(o=i[0])||void 0===o||null===(a=o.link)||void 0===a?void 0:a.key;case 11:s=t.t2,e.linkKey=null!==s&&void 0!==s?s:"";case 13:case"end":return t.stop()}}),t)})))()},copyLink:function(){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$copyText(t.link);case 2:t.$notify({type:"success",title:"Success",text:"Link copied to clipboard!"});case 3:case"end":return e.stop()}}),e)})))()},toggleProductInShop:function(){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=Object(v["a"])(t.existingShopProductIds),n.length){e.next=5;break}t.addToShop(t.link),e.next=12;break;case 5:r=0;case 6:if(!(r<n.length)){e.next=12;break}return e.next=9,t.removeFromShop(n[r]);case 9:r++,e.next=6;break;case 12:case"end":return e.stop()}}),e)})))()},addToShop:function(t){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$store.dispatch("addProduct",{image:e.product.image_url,name:e.product.name,description:"",url:t,price:null!==(r=e.product.price.amount)&&void 0!==r?r:0});case 2:return n.next=4,e.fetchOrUpdateLink(!0);case 4:return n.next=6,e.$store.dispatch("fetchActivePromotedLinks");case 6:e.displayPopup=!1;case 7:case"end":return n.stop()}}),n)})))()},addDealToShop:function(t){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$store.dispatch("addProduct",{image:e.deal.image_url,name:e.deal.name,description:e.deal.description,url:t,price:0,deal_id:e.deal.id});case 2:return e.$dropConfetti(),n.next=5,e.fetchOrUpdateLink(!0);case 5:return n.next=7,e.$store.dispatch("fetchActivePromotedLinks");case 7:e.displayDealPopup=!1;case 8:case"end":return n.stop()}}),n)})))()},removeFromShop:function(t){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.$store.dispatch("deleteProduct",t);case 1:case"end":return n.stop()}}),n)})))()},handleGenerateClick:function(){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("fetchActivePromotedLinks");case 2:if(!(t.$store.getters.activePromotedLinks.length>=t.$store.getters.promotionLinkLimit)){e.next=6;break}return t.$router.replace({hash:"#show-upgrade",query:{p_limit:!0}}),F["b"].logEvent("SHOWN_PAYWALL",{reason:"link-limit-reached",origin:"generate-product-link"}),e.abrupt("return");case 6:t.$amp.logEvent("GENERATED_LINK_FROM_ORG",{type:t.deal?"deal":"product",item:null!==(n=t.deal)&&void 0!==n?n:t.product}),t.deal?t.displayDealPopup=!0:t.displayProductPopup=!0;case 8:case"end":return e.stop()}}),e)})))()},handlePopupClosed:function(t){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.fetchOrUpdateLink(!0),n.next=3,e.$store.dispatch("fetchActivePromotedLinks");case 3:n.t0=t,n.next="product"===n.t0?6:"deal"===n.t0?8:10;break;case 6:return e.displayProductPopup=!1,n.abrupt("break",10);case 8:return e.displayDealPopup=!1,n.abrupt("break",10);case 10:case"end":return n.stop()}}),n)})))()}},apollo:{shopUrl:{query:Y,variables:function(){var t;return{influencer_id:null===(t=this.$user)||void 0===t?void 0:t.influencer.id}},update:function(t){var e,n;return null!==(e=null===t||void 0===t||null===(n=t.url_key)||void 0===n?void 0:n.url_key)&&void 0!==e?e:""}},deals:{query:B,result:function(t){var e,n=this;this.deal=null!==(e=t.data.deals.find((function(t){return t.network_product_id===n.product.network_product_id})))&&void 0!==e?e:null}}}}),H=V,W=(n("c133"),Object(T["a"])(H,D,M,!1,null,"2eec23b6",null)),Z=W.exports,X=n("2ef0"),J=n("11de"),Q=Object(y["a"])(u||(u=Object(b["a"])(["\n\tquery GetOrganization($id: uuid!) {\n\t\torganization: users_organization_by_pk(id: $id) {\n\t\t\tid\n\t\t\tname\n\t\t\tdescription\n\t\t\timage_logo\n\t\t\timage_banner\n\t\t\tcommission_estimate\n\t\t\tflat_commission\n\t\t\tcommission_summary\n\t\t\tcommission_description\n\t\t\tepc_90\n\t\t\twebsite_url\n\t\t\tadvertisers {\n\t\t\t\tid\n\t\t\t\tnetwork_advertiser_id\n\t\t\t}\n\t\t}\n\t}\n"]))),tt=Object(y["a"])(l||(l=Object(b["a"])(['\n\tquery GetOrganizationLink($influencerId: uuid!, $organizationId: uuid!) {\n\t\torganizationLink: attribution_organization_link(\n\t\t\twhere: {\n\t\t\t\tlink: {\n\t\t\t\t\tinfluencer_id: { _eq: $influencerId }\n\t\t\t\t\tstatus: { _eq: "ACTIVE" }\n\t\t\t\t}\n\t\t\t\torganization_id: { _eq: $organizationId }\n\t\t\t}\n\t\t) {\n\t\t\tlink {\n\t\t\t\tid\n\t\t\t\tkey\n\t\t\t}\n\t\t}\n\t}\n']))),et=Object(y["a"])(d||(d=Object(b["a"])(['\n\tquery GetLinkByProductId($influencerId: uuid!, $networkProductId: String!) {\n\t\tproductLinks: attribution_product_link(\n\t\t\twhere: {\n\t\t\t\tlink: {\n\t\t\t\t\tinfluencer_id: { _eq: $influencerId }\n\t\t\t\t\tstatus: { _eq: "ACTIVE" }\n\t\t\t\t}\n\t\t\t\tproduct: {\n\t\t\t\t\tnetwork_products: { network_product_id: { _eq: $networkProductId } }\n\t\t\t\t}\n\t\t\t}\n\t\t) {\n\t\t\tlink {\n\t\t\t\tid\n\t\t\t}\n\t\t}\n\t}\n']))),nt=Object(y["a"])(p||(p=Object(b["a"])(['\n\tmutation DeactivateLinkById($id: uuid!) {\n\t\tupdate_attribution_link_by_pk(\n\t\t\tpk_columns: { id: $id }\n\t\t\t_set: { status: "INACTIVE" }\n\t\t) {\n\t\t\tid\n\t\t}\n\t}\n']))),rt=Object(y["a"])(m||(m=Object(b["a"])(['\n\tquery GetPromotedProductsForOrganization(\n\t\t$influencerId: uuid!\n\t\t$organizationId: uuid!\n\t) {\n\t\tproductLinks: attribution_product_link(\n\t\t\twhere: {\n\t\t\t\tlink: {\n\t\t\t\t\tinfluencer_id: { _eq: $influencerId }\n\t\t\t\t\tstatus: { _eq: "ACTIVE" }\n\t\t\t\t}\n\t\t\t\tproduct: { organization_id: { _eq: $organizationId } }\n\t\t\t}\n\t\t) {\n\t\t\tproduct {\n\t\t\t\tid\n\t\t\t\torganization_id\n\t\t\t\tname\n\t\t\t\timage_url\n\t\t\t\tproduct_url\n\t\t\t\tdescription\n\t\t\t\tnetwork_products {\n\t\t\t\t\tid\n\t\t\t\t\tnetwork_product_id\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n']))),it=Object(y["a"])(f||(f=Object(b["a"])(["\n\tquery GetShopUrlKey($influencer_id: uuid!) {\n\t\turl_key: shop_banner_by_pk(influencer_id: $influencer_id) {\n\t\t\turl_key\n\t\t}\n\t}\n"]))),ot={components:{ProductRow:G,PopupContainer:x["a"],BrandPromotionPopup:K["a"],MobileProductRow:Z,ConfirmationModal:j["a"],Modal:J["a"]},data:function(){return{displayPopup:!1,organizationLinkKey:"",shopUrl:"",showConfirm:!1,organization:null,offset:0,nextPageLoading:!1,lastPageLoaded:!1,products:[],promotedProducts:[],searchCriteria:null,showCommissionModal:!1}},created:function(){"influencer"===this.$userType&&this.initializeShop()},computed:Object(_["a"])(Object(_["a"])({},Object(w["c"])({links:"links",activePromotedLinks:"activePromotedLinks",promotionLinkLimit:"promotionLinkLimit"})),{},{searchOption:function(){var t;return null!==(t=this.$route.query.search)&&void 0!==t?t:"all"},filteredProducts:function(){return"all"==this.searchOption?this.products:this.promotedProducts},lastProduct:function(){var t;return document.getElementById(null===(t=this.products[this.products.length-1])||void 0===t?void 0:t.network_product_id)},link:function(){return"https://".concat(this.$data.$shopDomain,"/").concat(this.shopUrl,"/").concat(this.organizationLinkKey)},existingShopCustomLinkIds:function(){var t=this;return this.links.filter((function(e){return e.data.url===t.link})).map((function(t){return t.link_id}))},promotionLimitReached:function(){return this.activePromotedLinks.length>=this.promotionLinkLimit},maxProLinks:function(){return R["a"].PROMOTED_LINKS.MAX_PRO},isProUser:function(){var t,e;return null!==(t=null===(e=this.$user)||void 0===e?void 0:e.athlane_pro)&&void 0!==t&&t}}),mounted:function(){var t=this;this.loadProducts(),"live"==this.searchOption&&this.loadPromotedProducts(),window.onwheel=function(){t.nextPageLoading||t.lastPageLoaded||"all"==t.searchOption&&t.isScrolledIntoView(t.lastProduct)&&(console.log("Loading more..."),t.loadProducts())},this.fetchOrUpdateLink()},methods:{removeDeal:function(){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.existingShopCustomLinkIds.length){e.next=3;break}return e.next=3,t.toggleLinkInShop();case 3:return e.next=5,t.endOrganizationPromotion();case 5:return t.organizationLinkKey="",t.showConfirm=!1,e.next=9,t.$store.dispatch("fetchShopData",t.$user.influencer.id);case 9:return e.next=11,t.$store.dispatch("fetchActivePromotedLinks");case 11:case"end":return e.stop()}}),e)})))()},fetchOrUpdateLink:function(){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){var n,r,i,o,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$apollo.query({query:tt,variables:{influencerId:t.$user.influencer.id,organizationId:t.$route.params.id},fetchPolicy:"no-cache"});case 2:if(e.t1=n=e.sent,e.t0=null===e.t1,e.t0){e.next=6;break}e.t0=void 0===n;case 6:if(!e.t0){e.next=10;break}e.t2=void 0,e.next=11;break;case 10:e.t2=null===(r=n.data)||void 0===r||null===(i=r.organizationLink)||void 0===i||null===(o=i[0])||void 0===o||null===(a=o.link)||void 0===a?void 0:a.key;case 11:s=e.t2,t.organizationLinkKey=null!==s&&void 0!==s?s:"";case 13:case"end":return e.stop()}}),e)})))()},copyLink:function(){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$copyText(t.link);case 2:t.$notify({type:"success",title:"Success",text:"Link copied to clipboard!"});case 3:case"end":return e.stop()}}),e)})))()},initializeShop:function(){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("fetchShopData",t.$user.influencer.id);case 2:case"end":return e.stop()}}),e)})))()},endOrganizationPromotion:function(){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){var n,r,i,o,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$apollo.query({query:tt,variables:{influencerId:t.$user.influencer.id,organizationId:t.$route.params.id}});case 2:if(e.t1=n=e.sent,e.t0=null===e.t1,e.t0){e.next=6;break}e.t0=void 0===n;case 6:if(!e.t0){e.next=10;break}e.t2=void 0,e.next=11;break;case 10:e.t2=null===(r=n.data)||void 0===r||null===(i=r.organizationLink)||void 0===i||null===(o=i[0])||void 0===o?void 0:o.link;case 11:return a=e.t2,e.next=14,t.$apollo.mutate({mutation:nt,variables:{id:null===a||void 0===a?void 0:a.id}});case 14:case"end":return e.stop()}}),e)})))()},endProductPromotion:function(t){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function n(){var r,i,o,a,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$apollo.query({query:et,variables:{influencerId:e.$user.influencer.id,networkProductId:t}});case 2:if(n.t1=r=n.sent,n.t0=null===n.t1,n.t0){n.next=6;break}n.t0=void 0===r;case 6:if(!n.t0){n.next=10;break}n.t2=void 0,n.next=11;break;case 10:n.t2=null===(i=r.data)||void 0===i||null===(o=i.productLinks)||void 0===o||null===(a=o[0])||void 0===a?void 0:a.link;case 11:return s=n.t2,n.next=14,e.$apollo.mutate({mutation:nt,variables:{id:null===s||void 0===s?void 0:s.id}});case 14:return n.next=16,e.$store.dispatch("fetchActivePromotedLinks");case 16:e.promotedProducts=e.promotedProducts.filter((function(e){return e.network_products.network_product_id!==t}));case 17:case"end":return n.stop()}}),n)})))()},toggleLinkInShop:function(){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=Object(v["a"])(t.existingShopCustomLinkIds),n.length){e.next=5;break}t.addToShop(t.link),e.next=12;break;case 5:r=0;case 6:if(!(r<n.length)){e.next=12;break}return e.next=9,t.removeFromShop(n[r]);case 9:r++,e.next=6;break;case 12:case"end":return e.stop()}}),e)})))()},addToShop:function(t){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$store.dispatch("addLink",{data:{url:t,tagline:e.organization.name,description:"",image_url:e.organization.image_logo},influencer_id:e.$user.influencer.id,clicks:0});case 2:return e.$dropConfetti(),e.fetchOrUpdateLink(),n.next=6,e.$store.dispatch("fetchActivePromotedLinks");case 6:e.displayPopup=!1;case 7:case"end":return n.stop()}}),n)})))()},removeFromShop:function(t){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.$store.dispatch("deleteLink",t);case 1:case"end":return n.stop()}}),n)})))()},isScrolledIntoView:function(t){if(!t)return!1;var e=t.getBoundingClientRect(),n=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);return e.top<n},loadPromotedProducts:function(){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){var n,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$apollo.query({query:rt,variables:{influencerId:t.$user.influencer.id,organizationId:t.$route.params.id}});case 2:if(e.t1=n=e.sent,e.t0=null===e.t1,e.t0){e.next=6;break}e.t0=void 0===n;case 6:if(!e.t0){e.next=10;break}e.t2=void 0,e.next=11;break;case 10:e.t2=null===(r=n.data)||void 0===r?void 0:r.productLinks;case 11:i=e.t2,t.promotedProducts=i.map((function(t){return Object(_["a"])(Object(_["a"])({},t.product),{},{network_product_id:t.product.network_products[0]["network_product_id"]})}));case 13:case"end":return e.stop()}}),e)})))()},handleSearch:Object(X["debounce"])(Object(g["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.offset=0,this.products=[],t.next=4,this.loadProducts();case 4:case"end":return t.stop()}}),t,this)}))),1e3),loadProducts:function(){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){var n,r,i,o,a,s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=20,t.nextPageLoading=!0,t.organization){e.next=7;break}return e.next=5,t.$apollo.query({query:Q,variables:{id:t.$route.params.id}});case 5:r=e.sent,t.organization=r.data.organization;case 7:if(!t.organization){e.next=16;break}return o=t.organization.advertisers[0]["network_advertiser_id"],e.next=11,t.$axios.get("/affiliates/search",{params:{q:null!==(i=t.searchCriteria)&&void 0!==i?i:"",limit:n,filter:o,offset:t.offset,type:"product"}}).catch((function(t){console.error(t.message)}));case 11:a=e.sent,s=a.data,c=s.results.map((function(t){return Object(_["a"])(Object(_["a"])({},t),{},{name:t["title"]})})),c.length<n&&(t.lastPageLoaded=!0),t.products=t.products.concat(c);case 16:t.offset+=n,t.nextPageLoading=!1;case 18:case"end":return e.stop()}}),e)})))()},handleGenerateClick:function(){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("fetchActivePromotedLinks");case 2:if(!t.promotionLimitReached){e.next=6;break}return t.$router.replace({hash:"#show-upgrade",query:{p_limit:!0}}),t.$amp.logEvent("SHOWN_PAYWALL",{reason:"link-limit-reached",origin:"generate-brand-link"}),e.abrupt("return");case 6:t.displayPopup=!0;case 7:case"end":return e.stop()}}),e)})))()},handlePopupClosed:function(){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.fetchOrUpdateLink(!0),e.next=3,t.$store.dispatch("fetchActivePromotedLinks");case 3:t.displayPopup=!1;case 4:case"end":return e.stop()}}),e)})))()}},apollo:{organization:{query:Q,variables:function(){return{id:this.$route.params.id}},update:function(t){return t.organization}},shopUrl:{query:it,variables:function(){return{influencer_id:this.$user.influencer.id}},update:function(t){return t.url_key.url_key}}}},at=ot,st=(n("475e"),Object(T["a"])(at,h,k,!1,null,"35b77f96",null));e["default"]=st.exports},"6ed5":function(t,e,n){"use strict";var r,i,o,a,s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("LinkPopup",{attrs:{type:"brand",organization:t.organization,loadingLink:t.loadingLink,shopUrl:t.shopUrl,linkKey:t.linkKey,link:t.link,copyLink:t.copyLink,errorGenerating:t.errorGenerating},on:{closed:function(e){return t.$emit("closed")},addToShop:t.addToShop}})},c=[],u=n("c964"),l=n("e5e9"),d=(n("96cf"),n("99af"),n("9911"),n("ac1f"),n("5319"),n("b0c0"),n("5184")),p=n("2b0e"),m=n("e1bd"),f=n("cacd"),h=Object(d["a"])(r||(r=Object(l["a"])(["\n\tquery GetShopUrlKey($influencer_id: uuid!) {\n\t\turl_key: shop_banner_by_pk(influencer_id: $influencer_id) {\n\t\t\turl_key\n\t\t}\n\t}\n"]))),k=Object(d["a"])(i||(i=Object(l["a"])(["\n\tquery GetOrganizationLink($influencerId: uuid!, $organizationId: uuid!) {\n\t\torganizationLinks: attribution_organization_link(\n\t\t\twhere: {\n\t\t\t\tlink: { influencer_id: { _eq: $influencerId } }\n\t\t\t\torganization_id: { _eq: $organizationId }\n\t\t\t}\n\t\t) {\n\t\t\tlink {\n\t\t\t\tid\n\t\t\t\tkey\n\t\t\t\tstatus\n\t\t\t}\n\t\t}\n\t}\n"]))),v=Object(d["a"])(o||(o=Object(l["a"])(["\n\tmutation InsertOrganizationLink(\n\t\t$organizationLink: attribution_organization_link_insert_input!\n\t) {\n\t\tinsert_attribution_organization_link(objects: [$organizationLink]) {\n\t\t\taffected_rows\n\t\t}\n\t}\n"]))),g=Object(d["a"])(a||(a=Object(l["a"])(['\n\tmutation ActivateLinkById($linkId: uuid!) {\n\t\tupdate_attribution_link_by_pk(\n\t\t\tpk_columns: { id: $linkId }\n\t\t\t_set: { status: "ACTIVE" }\n\t\t) {\n\t\t\tid\n\t\t}\n\t}\n']))),_=p["default"].extend({props:{organization:Object,addToShop:Function},components:{LinkPopup:f["a"]},data:function(){return{loadingLink:!0,shopUrl:"",linkKey:"",errorGenerating:!1}},computed:{link:function(){return"".concat(this.$data.$shopDomain,"/").concat(this.shopUrl,"/").concat(this.linkKey)}},mounted:function(){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function e(){var n,r,i,o,a,s,c,u,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$apollo.query({fetchPolicy:"no-cache",query:k,variables:{influencerId:t.$user.influencer.id,organizationId:t.organization.id}});case 2:if(e.t1=n=e.sent,e.t0=null===e.t1,e.t0){e.next=6;break}e.t0=void 0===n;case 6:if(!e.t0){e.next=10;break}e.t2=void 0,e.next=11;break;case 10:e.t2=null===(r=n.data)||void 0===r||null===(i=r.organizationLinks)||void 0===i||null===(o=i[0])||void 0===o?void 0:o.link;case 11:if(a=e.t2,null===a||void 0===a||!a.key){e.next=19;break}if("INACTIVE"!==(null===a||void 0===a?void 0:a.status)){e.next=16;break}return e.next=16,t.$apollo.query({fetchPolicy:"no-cache",query:g,variables:{linkId:a.id}});case 16:return t.linkKey=a.key,t.loadingLink=!1,e.abrupt("return");case 19:return s=t.organization.name.normalize("NFD").replace(/[^a-zA-Z0-9]/g,"").toLowerCase()||Object(m["a"])(6),t.linkKey=s,e.prev=21,e.next=24,t.$axios.get("affiliates/links",{params:{organization_id:t.organization.id,influencer_id:t.$user.influencer.id}});case 24:if(e.t4=c=e.sent,e.t3=null===e.t4,e.t3){e.next=28;break}e.t3=void 0===c;case 28:if(!e.t3){e.next=32;break}e.t5=void 0,e.next=33;break;case 32:e.t5=null===(u=c.data)||void 0===u?void 0:u.link;case 33:return l=e.t5,e.next=36,t.$apollo.mutate({mutation:v,variables:{organizationLink:{organization_id:t.organization.id,link:{data:{influencer_id:t.$user.influencer.id,url:l,key:t.linkKey}}}}});case 36:e.next=42;break;case 38:e.prev=38,e.t6=e["catch"](21),t.$notify({type:"error",title:"Error",text:"An error occurred while generating your affiliate link."}),t.errorGenerating=!0;case 42:t.loadingLink=!1;case 43:case"end":return e.stop()}}),e,null,[[21,38]])})))()},methods:{copyLink:function(){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.loadingLink){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,navigator.clipboard.writeText("https://".concat(t.link));case 4:t.$notify({type:"success",title:"Success",text:"Link copied to clipboard!"});case 5:case"end":return e.stop()}}),e)})))()}},apollo:{shopUrl:{query:h,fetchPolicy:"no-cache",variables:function(){return{influencer_id:this.$user.influencer.id}},update:function(t){var e;return null===(e=t.url_key)||void 0===e?void 0:e.url_key}}}}),b=_,x=n("2877"),y=Object(x["a"])(b,s,c,!1,null,null,null);e["a"]=y.exports},"92c1":function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"fixed inset-0 z-10 overflow-y-auto"},[n("div",{staticClass:"\n\t\t\tflex\n\t\t\titems-end\n\t\t\tjustify-center\n\t\t\tmin-h-screen\n\t\t\tpx-4\n\t\t\tpt-4\n\t\t\tpb-20\n\t\t\ttext-center\n\t\t\tsm:block\n\t\t\tsm:p-0\n\t\t"},[t._m(0),n("span",{staticClass:"hidden sm:inline-block sm:align-middle sm:h-screen",attrs:{"aria-hidden":"true"}},[t._v("â€‹")]),n("div",{staticClass:"\n\t\t\t\tinline-block\n\t\t\t\tpx-4\n\t\t\t\tpt-5\n\t\t\t\tpb-4\n\t\t\t\toverflow-hidden\n\t\t\t\ttext-left\n\t\t\t\talign-bottom\n\t\t\t\ttransition-all\n\t\t\t\ttransform\n\t\t\t\tbg-white\n\t\t\t\trounded-lg\n\t\t\t\tshadow-xl\n\t\t\t\tsm:my-8\n\t\t\t\tsm:align-middle\n\t\t\t\tsm:max-w-lg\n\t\t\t\tsm:w-full\n\t\t\t\tsm:p-6\n\t\t\t",attrs:{role:"dialog","aria-modal":"true","aria-labelledby":"modal-headline"}},[n("div",{staticClass:"sm:flex sm:items-start"},[n("div",{staticClass:"\n\t\t\t\t\t\tflex\n\t\t\t\t\t\titems-center\n\t\t\t\t\t\tjustify-center\n\t\t\t\t\t\tflex-shrink-0\n\t\t\t\t\t\tw-12\n\t\t\t\t\t\th-12\n\t\t\t\t\t\tmx-auto\n\t\t\t\t\t\tbg-red-100\n\t\t\t\t\t\trounded-full\n\t\t\t\t\t\tsm:mx-0\n\t\t\t\t\t\tsm:h-10\n\t\t\t\t\t\tsm:w-10\n\t\t\t\t\t"},[n("svg",{staticClass:"w-6 h-6 text-red-600",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"}},[n("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"}})])]),n("div",{staticClass:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},[n("h3",{staticClass:"text-lg font-medium leading-6 text-gray-900",attrs:{id:"modal-headline"}},[t._v(" "+t._s(t.title)+" ")]),n("div",{staticClass:"mt-2"},[n("p",{staticClass:"text-sm text-gray-500"},[t._v(" "+t._s(t.text)+" ")])])])]),n("div",{staticClass:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse"},[n("button",{staticClass:"\n\t\t\t\t\t\tinline-flex\n\t\t\t\t\t\tjustify-center\n\t\t\t\t\t\tw-full\n\t\t\t\t\t\tpx-4\n\t\t\t\t\t\tpy-2\n\t\t\t\t\t\ttext-base\n\t\t\t\t\t\tfont-medium\n\t\t\t\t\t\ttext-white\n\t\t\t\t\t\tbg-red-600\n\t\t\t\t\t\tborder border-transparent\n\t\t\t\t\t\trounded-md\n\t\t\t\t\t\tshadow-sm\n\t\t\t\t\t\thover:bg-red-700\n\t\t\t\t\t\tfocus:outline-none\n\t\t\t\t\t\tfocus:ring-2 focus:ring-offset-2 focus:ring-red-500\n\t\t\t\t\t\tsm:ml-3\n\t\t\t\t\t\tsm:w-auto\n\t\t\t\t\t\tsm:text-sm\n\t\t\t\t\t",attrs:{type:"button"},on:{click:function(e){return t.$emit("confirm")}}},[t._v(" Confirm ")]),n("button",{staticClass:"\n\t\t\t\t\t\tinline-flex\n\t\t\t\t\t\tjustify-center\n\t\t\t\t\t\tw-full\n\t\t\t\t\t\tpx-4\n\t\t\t\t\t\tpy-2\n\t\t\t\t\t\tmt-3\n\t\t\t\t\t\ttext-base\n\t\t\t\t\t\tfont-medium\n\t\t\t\t\t\ttext-gray-700\n\t\t\t\t\t\tbg-white\n\t\t\t\t\t\tborder border-gray-300\n\t\t\t\t\t\trounded-md\n\t\t\t\t\t\tshadow-sm\n\t\t\t\t\t\thover:bg-gray-50\n\t\t\t\t\t\tfocus:outline-none\n\t\t\t\t\t\tfocus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\n\t\t\t\t\t\tsm:mt-0\n\t\t\t\t\t\tsm:w-auto\n\t\t\t\t\t\tsm:text-sm\n\t\t\t\t\t",attrs:{type:"button"},on:{click:function(e){return t.$emit("cancel")}}},[t._v(" Cancel ")])])])])])},i=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"fixed inset-0 transition-opacity",attrs:{"aria-hidden":"true"}},[n("div",{staticClass:"absolute inset-0 bg-gray-500 opacity-75"})])}],o={props:{text:String,title:String}},a=o,s=n("2877"),c=Object(s["a"])(a,r,i,!1,null,null,null);e["a"]=c.exports},"9b0b":function(t,e,n){},"9b1e":function(t,e,n){},a29c:function(t,e,n){"use strict";var r,i,o,a,s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("LinkPopup",{attrs:{type:"deal",organization:t.organization,loadingLink:t.loadingLink,shopUrl:t.shopUrl,linkKey:t.linkKey,link:t.link,copyLink:t.copyLink,errorGenerating:t.errorGenerating},on:{closed:function(e){return t.$emit("closed")},addToShop:t.addToShop}})},c=[],u=n("c964"),l=n("e5e9"),d=(n("96cf"),n("99af"),n("9911"),n("ac1f"),n("5319"),n("b0c0"),n("d3b7"),n("3ca3"),n("ddb0"),n("2b3d"),n("d28b"),n("a4d3"),n("e01a"),n("5184")),p=n("2b0e"),m=n("e1bd"),f=n("cacd"),h=Object(d["a"])(r||(r=Object(l["a"])(["\n\tquery GetShopUrlKey($influencer_id: uuid!) {\n\t\turl_key: shop_banner_by_pk(influencer_id: $influencer_id) {\n\t\t\turl_key\n\t\t}\n\t}\n"]))),k=Object(d["a"])(i||(i=Object(l["a"])(["\n\tquery GetProductLink($influencerId: uuid!, $networkProductId: String!) {\n\t\tproductLinks: attribution_product_link(\n\t\t\twhere: {\n\t\t\t\tlink: { influencer_id: { _eq: $influencerId } }\n\t\t\t\tproduct: {\n\t\t\t\t\tnetwork_products: { network_product_id: { _eq: $networkProductId } }\n\t\t\t\t}\n\t\t\t}\n\t\t) {\n\t\t\tlink {\n\t\t\t\tid\n\t\t\t\tkey\n\t\t\t\tstatus\n\t\t\t}\n\t\t}\n\t}\n"]))),v=Object(d["a"])(o||(o=Object(l["a"])(["\n\tmutation InsertProductLink(\n\t\t$productLink: attribution_product_link_insert_input!\n\t) {\n\t\tinsert_attribution_product_link(objects: [$productLink]) {\n\t\t\taffected_rows\n\t\t}\n\t}\n"]))),g=Object(d["a"])(a||(a=Object(l["a"])(['\n\tmutation ActivateLinkById($linkId: uuid!) {\n\t\tupdate_attribution_link_by_pk(\n\t\t\tpk_columns: { id: $linkId }\n\t\t\t_set: { status: "ACTIVE" }\n\t\t) {\n\t\t\tid\n\t\t}\n\t}\n']))),_=p["default"].extend({props:{deal:Object,organization:Object,addToShop:Function},components:{LinkPopup:f["a"]},data:function(){return{loadingLink:!0,shopUrl:"",linkKey:"",errorGenerating:!1}},computed:{link:function(){return"".concat(this.$data.$shopDomain,"/").concat(this.shopUrl,"/").concat(this.linkKey)}},mounted:function(){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.deal.network_product_id){e.next=3;break}return console.error("deal must have network_product_id to generate affiliateLink"),e.abrupt("return");case 3:return e.next=5,t.getExistingLink();case 5:if(n=e.sent,n){e.next=9;break}return e.next=9,t.generateNewLink();case 9:t.loadingLink=!1;case 10:case"end":return e.stop()}}),e)})))()},methods:{getExistingLink:function(){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function e(){var n,r,i,o,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$apollo.query({fetchPolicy:"no-cache",query:k,variables:{influencerId:t.$user.influencer.id,networkProductId:t.deal.network_product_id}});case 2:if(e.t2=r=e.sent.data,e.t1=null===e.t2,e.t1){e.next=6;break}e.t1=void 0===r;case 6:if(!e.t1){e.next=10;break}e.t3=void 0,e.next=11;break;case 10:e.t3=null===(i=r.productLinks)||void 0===i||null===(o=i[0])||void 0===o?void 0:o.link;case 11:if(e.t4=n=e.t3,e.t0=null!==e.t4,!e.t0){e.next=15;break}e.t0=void 0!==n;case 15:if(!e.t0){e.next=19;break}e.t5=n,e.next=20;break;case 19:e.t5=null;case 20:if(a=e.t5,"INACTIVE"!==(null===a||void 0===a?void 0:a.status)){e.next=24;break}return e.next=24,t.$apollo.query({fetchPolicy:"no-cache",query:g,variables:{linkId:a.id}});case 24:return t.linkKey=null===a||void 0===a?void 0:a.key,e.abrupt("return",a);case 26:case"end":return e.stop()}}),e)})))()},generateNewLink:function(){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function e(){var n,r,i,o,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.deal.name.normalize("NFD").replace(/[^a-zA-Z0-9]/g,"").substring(0,8).toLowerCase()||Object(m["a"])(6),r=t.organization.name.normalize("NFD").replace(/[^a-zA-Z0-9]/g,"").substring(0,8).toLowerCase()||Object(m["a"])(6),t.linkKey="".concat(r,"/").concat(n),e.prev=3,e.next=6,t.$axios.get("affiliates/links",{params:{network_product_id:t.deal.network_product_id,influencer_id:t.$user.influencer.id}});case 6:return o=e.sent,a=new URL(t.deal.tracking_link),a.searchParams.append("afftrack",t.$user.influencer.id),s=null===o||void 0===o||null===(i=o.data)||void 0===i?void 0:i.product,e.next=12,t.createLink(a,t.linkKey,s.product.id,0);case 12:e.next=19;break;case 14:e.prev=14,e.t0=e["catch"](3),console.error(e.t0),t.$notify({type:"error",title:"Error",text:"An error occurred while generating your affiliate link."}),t.errorGenerating=!0;case 19:case"end":return e.stop()}}),e,null,[[3,14]])})))()},createLink:function(t,e,n,r){var i=this;return Object(u["a"])(regeneratorRuntime.mark((function o(){var a;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return a=e+(r>0?"-"+r:""),i.linkKey=a,o.next=4,i.$apollo.mutate({mutation:v,variables:{productLink:{product_id:n,link:{data:{influencer_id:i.$user.influencer.id,url:t,key:a}}}}}).catch(function(){var o=Object(u["a"])(regeneratorRuntime.mark((function o(a){var s,c,u,l,d,p,m,f;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:for(s=!1,c=a["graphQLErrors"],u=!0,l=!1,d=void 0,o.prev=5,p=c[Symbol.iterator]();!(u=(m=p.next()).done);u=!0)f=m.value,"constraint-violation"===f.extensions.code&&(s=!0),console.log(f);o.next=13;break;case 9:o.prev=9,o.t0=o["catch"](5),l=!0,d=o.t0;case 13:o.prev=13,o.prev=14,u||null==p.return||p.return();case 16:if(o.prev=16,!l){o.next=19;break}throw d;case 19:return o.finish(16);case 20:return o.finish(13);case 21:if(!s){o.next=26;break}return o.next=24,i.createLink(t,e,n,r+1);case 24:o.next=27;break;case 26:console.error(a);case 27:case"end":return o.stop()}}),o,null,[[5,9,13,21],[14,,16,20]])})));return function(t){return o.apply(this,arguments)}}());case 4:case"end":return o.stop()}}),o)})))()},copyLink:function(){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.loadingLink){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,navigator.clipboard.writeText("https://".concat(t.link));case 4:t.$notify({type:"success",title:"Success",text:"Link copied to clipboard!"});case 5:case"end":return e.stop()}}),e)})))()}},apollo:{shopUrl:{query:h,variables:function(){return{influencer_id:this.$user.influencer.id}},update:function(t){return t.url_key.url_key}}}}),b=_,x=n("2877"),y=Object(x["a"])(b,s,c,!1,null,null,null);e["a"]=y.exports},a308:function(t,e,n){"use strict";n("30b6")},af30:function(t,e,n){},b022:function(t,e,n){},c133:function(t,e,n){"use strict";n("9b1e")},cacd:function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"popup shadow-lg rounded-lg pt-2"},[n("div",{staticClass:"overlay"}),n("div",{staticClass:"popup-header flex justify-between p-6"},[n("h2",{staticClass:"font-semibold text-gray-800"},[t._v(" Your "+t._s(t.organization.name)+" "+t._s("brand"===t.type?"Brand":"product"===t.type?"Product":"Coupon")+" Deal ")]),n("i",{staticClass:"close-button fas fa-times cursor-pointer text-2xl text-gray-400 hover:text-gray-600 transition-colors duration-200",on:{click:function(e){return t.$emit("closed")}}})]),n("div",{staticClass:"popup-body px-8"},["deal"!=t.type&&(t.organization.commission_estimate||t.organization.epc_90)?n("div",{staticClass:"earnings-row flex my-8"},[n("div",{staticClass:"font-semibold text-xl w-2/5 flex items-center text-gray-800"},[t._v(" Your earnings: ")]),t.organization.commission_estimate?n("div",{staticClass:"amount"},[n("div",{staticClass:"text-xl text-indigo-600 font-medium"},[t._v(" "+t._s(t.organization.commission_estimate)+"% ")]),n("div",{staticClass:"text-sm text-gray-400"},[t._v("Commission")])]):t._e(),t.organization.epc_90?n("div",{staticClass:"amount"},[n("div",{staticClass:"text-xl text-indigo-600 font-medium"},[t._v(" $"+t._s(t.organization.epc_90)+" ")]),n("div",{staticClass:"text-sm text-gray-400"},[t._v("EPC")])]):t._e()]):t._e(),n("div",{staticClass:"font-semibold text-base md:text-xl mb-4 text-gray-800"},[t._v(" Your custom link to promote: ")]),n("div",{staticClass:"link-container text-primary text-lg font-medium p-8 flex flex-col items-center justify-center cursor-default",class:{"cursor-pointer":!t.errorGenerating&&!t.loadingLink},on:{click:function(e){e.stopPropagation(),!t.errorGenerating&&!t.loadingLink&&t.copyLink()}}},[t.errorGenerating?n("div",[t._m(0)]):t.loadingLink?n("div",{staticClass:"loading"},[n("i",{staticClass:"fas fa-spinner fa-spin"}),n("span",[t._v("Generating your custom link...")])]):n("span",{staticClass:"link font-semibold text-2xl text-center"},[t._v(" "+t._s(t.link)+" ")]),t.loadingLink||t.errorGenerating?t._e():n("span",{staticClass:"copy-message text-sm mt-6 font-normal transition-colors duration-200"},[t._v(" Click to copy ")])])]),n("div",{staticClass:"p-8 pt-6 border-t border-solid border-indigo-100 flex justify-end items-center buttons"},[n("span",{staticClass:"whitespace-nowrap mr-4 cursor-pointer text-gray-500 hover:text-gray-600 transition-colors duration-200",on:{click:function(e){return t.$emit("closed")}}},[t._v("I'll do this later")]),n("button",{staticClass:"rounded primary",class:{disabled:t.loadingLink},on:{click:function(e){return t.$emit("addToShop","https://"+t.link)}}},[t._v(" Add to My Pillar ")])])])},i=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{staticClass:"error-message text-gray-500 text-sm font-normal"},[n("i",{staticClass:"fas fa-exclamation-triangle"}),t._v(" Something went wrong. Please try again later. ")])}],o=n("2b0e"),a=o["default"].extend({props:{type:String,organization:Object,addToShop:Function,link:String,loadingLink:Boolean,shopUrl:String,linkKey:String,copyLink:Function,errorGenerating:Boolean}}),s=a,c=(n("a308"),n("2877")),u=Object(c["a"])(s,r,i,!1,null,"46bff498",null);e["a"]=u.exports}}]);
//# sourceMappingURL=chunk-11e1e150.1329ca4a.js.map